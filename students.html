<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #4e54c8, #8f94fb);
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: 250px;
      background: rgba(78, 84, 200, 0.9);
      color: white;
      padding: 15px;
      box-shadow: 3px 0 12px rgba(0, 0, 0, 0.3);
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px);
      border-top-right-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    .student-panel {
      font-size: 28px;
      color: rgb(255, 255, 255);
      font-weight: bold;
      margin-bottom: 30px;
      text-shadow: 0 0 12px rgba(128, 128, 128, 0.8);
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      flex: 1;
    }

    .sidebar ul li {
      margin: 10px 0;
    }

    .sidebar ul li a {
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      display: block;
      border-radius: 10px;
      transition: .3s;
    }

    .sidebar ul li a:hover,
    .sidebar ul li a.active {
      background: rgba(143, 148, 251, 0.6);
      box-shadow: 0 0 15px rgba(143, 148, 251, 0.9);
      transform: scale(1.05);
    }

    .main-content {
      margin-left: 270px;
      padding: 30px;
      flex: 1;
      overflow-y: auto;
      width: calc(100% - 270px);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    section {
      padding: 25px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: .3s;
    }

    section.active-section {
      transform: translateY(-3px);
      box-shadow: 0 0 20px rgba(101, 180, 244, 0.8);
    }

    h2 {
      color: #4e54c8;
      font-weight: 700;
    }

    button {
      background: linear-gradient(to right, #4e54c8, #8f94fb);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: .3s;
      margin-top: 8px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
    }

    .welcome-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 20px;
      margin-bottom: 20px;
      color: white;
      transition: .3s;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }

    .welcome-details:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }

    .welcome-details p {
      margin: 0;
      font-size: 18px;
    }

    .logout-button {
      background: linear-gradient(to right, #4e54c8, #8f94fb);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: .3s;
    }

    .logout-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .course-entry,
    .attendance-entry,
    .announcement-card {
      background: #fff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
      transition: .3s;
    }

    .course-entry:hover,
    .attendance-entry:hover,
    .announcement-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .course-entry strong,
    .attendance-title,
    .announcement-title {
      font-size: 18px;
      font-weight: bold;
      color: #4e54c8;
      margin-bottom: 8px;
    }

    .course-entry span,
    .attendance-text,
    .announcement-text {
      color: #555;
      display: block;
    }

    #availableCourses {
  width: 240px; /* Adjust as needed for your layout */
  padding: 12px 16px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(to right, #ffffff, #f0f0ff);
  font-size: 16px;
  color: #4e54c8;
  font-weight: 500;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.1);
  margin-right: 12px;
  transition: all 0.3s ease;
  appearance: none;
  cursor: pointer;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%234e54c8' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 12px;
}

#availableCourses:focus {
  outline: none;
  box-shadow: 0 0 12px rgba(143, 148, 251, 0.8);
  transform: scale(1.03);
}


  </style>
</head>

<body>
  <div class="sidebar">
    <div class="student-panel">Student Panel</div>
    <ul>
      <li><a href="#profile" class="active">Profile</a></li>
      <li><a href="#courses">My Courses</a></li>
      <li><a href="#attendance">Attendance</a></li>
      <li><a href="#grades">My Grades</a></li>
      <li><a href="#announcements">Announcements</a></li>
    </ul>
  </div>

  <div class="main-content">
    <div class="welcome-details">
      <p><strong>Welcome,</strong> <span id="studentName"></span></p>
      <p><strong>Grade:</strong> <span id="studentGrade"></span></p>
      <p><strong>ID:</strong> <span id="studentId"></span></p>
      <p><strong>Email:</strong> <span id="studentEmail"></span></p>
      <button class="logout-button" onclick="logout()">Logout</button>
    </div>

    <section id="profile" class="active-section">
      <h2>My Profile</h2>
      <p>View or update your profile here.</p>
    </section>

    <section id="courses">
      <h2>My Courses</h2>
      <div style="margin-bottom: 15px;">
        <select id="availableCourses">
          <option disabled selected>Loading courses...</option>
        </select>
        <button onclick="enroll()">Enroll</button>
      </div>
      <div id="myCourses"></div>
    </section>

    <section id="attendance">
      <h2>My Attendance</h2>
      <button onclick="window.location.href='studentattendancetrack.html'">View Attendance</button>
      <div id="myAttendance"></div>
    </section>
    <section id="grades">
      <h2>My Grades</h2>
      <p>View your grades and academic progress.</p>
      <button onclick="location.href='studentGrade.html'">View Grades</button>
    </section>

    <section id="announcements">
      <h2>Announcements</h2>
      <div id="announcementList"></div>
    </section>
  </div>

  <script>
    let currentUser;

    document.addEventListener('DOMContentLoaded', () => {
      currentUser = localStorage.getItem('loggedInUsername');
      if (!currentUser) return window.location.href = 'login.html';

      const students = JSON.parse(localStorage.getItem('students')) || [];
      const me = students.find(s => s.username === currentUser);
      if (!me) return window.location.href = 'login.html';

      document.getElementById('studentName').textContent = me.name;
      document.getElementById('studentGrade').textContent = me.grade;
      document.getElementById('studentId').textContent = me.studentId;
      document.getElementById('studentEmail').textContent = me.email;

      populateAvailableCourses();
      renderMyCourses();
      renderAttendance();
      renderAnnouncements();
    });

    function getCourses() {
      return JSON.parse(localStorage.getItem('courses')) || [];
    }

    function saveCourses(list) {
      localStorage.setItem('courses', JSON.stringify(list));
    }

    function populateAvailableCourses() {
      const sel = document.getElementById('availableCourses');
      sel.innerHTML = '';
      const available = getCourses().filter(c => !Array.isArray(c.students) || !c.students.includes(currentUser));
      if (available.length === 0) {
        sel.innerHTML = '<option disabled>No courses available</option>';
      } else {
        available.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c.courseCode;
          opt.textContent = c.courseName;
          sel.appendChild(opt);
        });
      }
    }

    function enroll() {
      const code = document.getElementById('availableCourses').value;
      if (!code) return alert('Select a course to enroll');
      const all = getCourses();
      const course = all.find(c => c.courseCode === code);
      if (!course.students) course.students = [];
      if (!course.students.includes(currentUser)) {
        course.students.push(currentUser);
        saveCourses(all);
        populateAvailableCourses();
        renderMyCourses();
        alert(`Enrolled in ${course.courseName}`);
      }
    }

    function unenroll(courseCode) {
      const all = getCourses();
      const course = all.find(c => c.courseCode === courseCode);
      if (!course || !course.students) return;
      course.students = course.students.filter(u => u !== currentUser);
      saveCourses(all);
      populateAvailableCourses();
      renderMyCourses();
      alert(`Unenrolled from ${course.courseName}`);
    }

    function renderMyCourses() {
      const container = document.getElementById('myCourses');
      container.innerHTML = '';
      const mine = getCourses().filter(c => Array.isArray(c.students) && c.students.includes(currentUser));
      if (mine.length === 0) {
        container.innerHTML = '<p style="color:gray;">Not enrolled in any courses.</p>';
      } else {
        mine.forEach(c => {
          const div = document.createElement('div');
          div.className = 'course-entry';
          div.innerHTML = `
            <strong>${c.courseName}</strong> 
            <span>(Instructor: ${c.instructor})</span>
            <button onclick="unenroll('${c.courseCode}')">Unenroll</button>
          `;
          container.appendChild(div);
        });
      }
    }

    function renderAttendance() {
      const key = currentUser + '_attendance';
      const log = JSON.parse(localStorage.getItem(key)) || {};
      const container = document.getElementById('myAttendance');
      container.innerHTML = '';
      const dates = Object.keys(log).sort((a, b) => b.localeCompare(a));
      dates.forEach(date => {
        const div = document.createElement('div');
        div.className = 'attendance-entry';
        div.innerHTML = `<div class="attendance-title">${date}</div><div class="attendance-text">${log[date]}</div>`;
        container.appendChild(div);
      });
    }

    function renderAnnouncements() {
      const list = document.getElementById('announcementList');
      const ann = JSON.parse(localStorage.getItem('studentAnnouncements')) || [];
      list.innerHTML = '';
      if (ann.length === 0) {
        list.innerHTML = '<p style="color:gray;">No announcements yet.</p>';
      } else {
        ann.forEach((text, i) => {
          const card = document.createElement('div');
          card.className = 'announcement-card';
          card.innerHTML = `<div class="announcement-title">Announcement ${i + 1}</div><div class="announcement-text">${text}</div>`;
          list.appendChild(card);
        });
      }
    }

    function logout() {
      localStorage.removeItem('loggedInUsername');
      window.location.href = 'main.html';
    }
  </script>
</body>

</html>